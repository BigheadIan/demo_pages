# 金龍永盛 AI 客服系統 - 整合測試報告

**測試日期**: 2025-12-17
**測試環境**: Google Cloud Run
**服務 URL**: `https://golden-dragon-ai-842316685130.asia-east1.run.app`
**測試工具**: Node.js Integration Test Script

---

## 一、測試摘要

| 測試類別 | 通過 | 失敗 | 總數 | 通過率 |
|---------|------|------|------|--------|
| 意圖分類測試 | 70 | 5 | 75 | **93.3%** |
| 對話流程測試 | 4 | 6 | 10 | **40.0%** |
| **總計** | **74** | **11** | **85** | **87.1%** |

---

## 二、意圖分類測試結果

### 2.1 各意圖測試結果

| 意圖代碼 | 測試案例數 | 通過 | 失敗 | 通過率 |
|---------|-----------|------|------|--------|
| GREETING | 5 | 4 | 1 | 80% |
| TICKET_BOOK | 5 | 5 | 0 | 100% |
| TICKET_CHANGE | 5 | 5 | 0 | 100% |
| TICKET_CANCEL | 5 | 5 | 0 | 100% |
| QUOTE_REQUEST | 5 | 5 | 0 | 100% |
| FLIGHT_QUERY | 5 | 5 | 0 | 100% |
| BOOKING_STATUS | 5 | 4 | 1 | 80% |
| VISA_INQUIRY | 5 | 4 | 1 | 80% |
| VISA_PROGRESS | 5 | 5 | 0 | 100% |
| PAYMENT_REQUEST | 5 | 5 | 0 | 100% |
| RECEIPT_REQUEST | 5 | 5 | 0 | 100% |
| PASSENGER_INFO | 5 | 5 | 0 | 100% |
| BAGGAGE_INQUIRY | 5 | 5 | 0 | 100% |
| SEAT_REQUEST | 5 | 5 | 0 | 100% |
| TRANSFER_AGENT | 5 | 3 | 2 | 60% |
| FAQ_GENERAL | - | - | - | - |

### 2.2 失敗案例分析

#### 失敗案例 1: BOOKING_STATUS
| 項目 | 內容 |
|------|------|
| **輸入** | "我的機票開好了嗎" |
| **預期** | BOOKING_STATUS |
| **實際** | TICKET_BOOK |
| **分析** | 「開票」一詞同時帶有「訂票」與「查詢狀態」的語意，模型傾向解讀為訂票請求 |
| **建議** | 調整 prompt 強調「開好了嗎」等詢問語氣應歸類為狀態查詢 |

#### 失敗案例 2: VISA_INQUIRY
| 項目 | 內容 |
|------|------|
| **輸入** | "日本免簽可以待幾天" |
| **預期** | VISA_INQUIRY |
| **實際** | FAQ_GENERAL |
| **分析** | 此問題屬於一般知識性問答，模型認為更適合 FAQ 處理 |
| **建議** | 此分類可視為合理，無需調整（FAQ 內有相關資訊） |

#### 失敗案例 3: GREETING
| 項目 | 內容 |
|------|------|
| **輸入** | "好的" |
| **預期** | GREETING |
| **實際** | UNKNOWN |
| **分析** | 「好的」是確認詞而非問候語，模型無法判斷意圖 |
| **建議** | 新增 ACKNOWLEDGMENT 意圖或在 prompt 中說明確認詞的處理方式 |

#### 失敗案例 4-5: TRANSFER_AGENT
| 項目 | 內容 |
|------|------|
| **輸入** | "我要找人工客服" / "太複雜了找真人" |
| **預期** | TRANSFER_AGENT |
| **實際** | UNKNOWN |
| **分析** | 轉接人工的表達方式多樣，模型尚未完全覆蓋 |
| **建議** | 在 prompt 中增加更多轉接人工的範例表達 |

---

## 三、對話流程測試結果

### 3.1 測試場景

| 場景 | 步驟數 | 通過 | 失敗 | 狀態 |
|------|--------|------|------|------|
| 訂票完整流程 | 5 | 3 | 2 | 部分通過 |
| 改票完整流程 | 5 | 1 | 4 | 失敗 |

### 3.2 訂票流程測試詳情

| 步驟 | 輸入 | 預期意圖 | 實際結果 | 狀態 |
|------|------|---------|---------|------|
| 1 | "我想訂機票去東京" | TICKET_BOOK | UNKNOWN | ❌ |
| 2 | "大概下個月中，兩個人" | PASSENGER_INFO | PASSENGER_INFO | ✅ |
| 3 | "華航或長榮都可以" | TICKET_BOOK | TICKET_BOOK | ✅ |
| 4 | "經濟艙就好" | SEAT_REQUEST | SEAT_REQUEST | ✅ |
| 5 | "好的請幫我查詢報價" | QUOTE_REQUEST | UNKNOWN | ❌ |

### 3.3 改票流程測試詳情

| 步驟 | 輸入 | 預期意圖 | 實際結果 | 狀態 |
|------|------|---------|---------|------|
| 1 | "我要改機票" | TICKET_CHANGE | UNKNOWN | ❌ |
| 2 | "訂位代號是 BTE123456" | BOOKING_STATUS | UNKNOWN | ❌ |
| 3 | "想改成 4/20 出發" | TICKET_CHANGE | UNKNOWN | ❌ |
| 4 | "回程不用改" | TICKET_CHANGE | UNKNOWN | ❌ |
| 5 | "這樣改票要收費嗎" | FAQ_GENERAL | FAQ_GENERAL | ✅ |

### 3.4 對話流程問題分析

**主要問題**: 新 Session 的第一個請求經常返回 UNKNOWN

**可能原因**:
1. **Cold Start 問題**: Cloud Run 服務啟動時間導致首次請求超時
2. **API 速率限制**: Gemini API 可能有請求間隔限制
3. **Session 初始化**: 新 Session 的 context 為空，影響意圖判斷
4. **Prompt 設計**: 缺乏足夠的上下文時，模型難以判斷意圖

**建議改進**:
1. 設定 Cloud Run minimum instances = 1 避免 cold start
2. 在 prompt 中加入處理「無上下文」情境的指引
3. 對於曖昧輸入，優先根據關鍵詞判斷意圖

---

## 四、實體提取測試結果

| 實體類型 | 測試案例 | 通過 | 狀態 |
|---------|---------|------|------|
| 日期提取 | 2025/04/15 | ✅ | 正常 |
| 目的地提取 | 東京、大阪 | ✅ | 正常 |
| 航班號提取 | CI100、BR190 | ✅ | 正常 |
| 訂位代號提取 | BTE2500208 | ✅ | 正常 |

**已修正問題**:
- ✅ 日期重複提取問題（追蹤已匹配位置）
- ✅ 航班號誤提取訂位代號（排除 BTE 前綴）

---

## 五、效能測試結果

| 指標 | 數值 | 評估 |
|------|------|------|
| 平均回應時間 | ~1.5-3 秒 | 可接受 |
| Cold Start 時間 | ~5-10 秒 | 需優化 |
| API 穩定性 | 98% | 良好 |

---

## 六、改進建議

### 6.1 高優先級

| 項目 | 說明 | 預期效果 |
|------|------|---------|
| 優化 TRANSFER_AGENT 識別 | 增加更多轉接人工的範例表達 | +5% 準確率 |
| 處理 Cold Start | 設定 minimum instances = 1 | 減少 UNKNOWN 回應 |
| 新增 ACKNOWLEDGMENT 意圖 | 處理「好的」、「了解」等確認詞 | 更好的對話體驗 |

### 6.2 中優先級

| 項目 | 說明 | 預期效果 |
|------|------|---------|
| 優化 BOOKING_STATUS 識別 | 區分「開票」與「查詢開票狀態」 | +2% 準確率 |
| 多輪對話狀態管理 | 實作 Finite State Machine | 對話流程準確率提升 |
| Session 持久化 | 改用 Firestore 儲存 | 支援跨請求狀態保持 |

### 6.3 低優先級

| 項目 | 說明 |
|------|------|
| 增加訓練範例 | 每個意圖增加至 20+ 範例 |
| A/B 測試框架 | 比較不同 prompt 版本效果 |
| 自動化測試 CI/CD | 部署前自動執行測試 |

---

## 七、結論

### 7.1 整體評估

| 評估項目 | 分數 | 說明 |
|---------|------|------|
| 意圖分類準確度 | ⭐⭐⭐⭐☆ | 93.3%，優於預期 |
| 實體提取準確度 | ⭐⭐⭐⭐⭐ | 100%，表現優異 |
| 對話流程支援 | ⭐⭐☆☆☆ | 40%，需要改進 |
| 系統穩定性 | ⭐⭐⭐⭐☆ | 整體穩定 |

### 7.2 上線建議

**可上線功能** (MVP):
- ✅ FAQ 自動回覆
- ✅ 單輪意圖識別（訂票、改票、簽證查詢等）
- ✅ 實體提取（日期、航班、目的地）
- ✅ LINE 訊息接收與回覆

**建議延後功能**:
- ⏸️ 多輪對話流程（需實作狀態機）
- ⏸️ 複雜訂票流程自動化（需整合 GDS）

### 7.3 下一步行動

1. **立即**: 優化 TRANSFER_AGENT prompt，提升轉接人工識別率
2. **本週**: 設定 Cloud Run minimum instances，減少 cold start
3. **下週**: 開始實作多輪對話狀態機

---

**報告產生時間**: 2025-12-17
**測試執行者**: Claude Code AI Assistant
